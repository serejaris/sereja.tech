---
title: "Семантический поиск по Telegram: мой second brain из чатов"
date: 2026-01-26
description: "Как я сделал поиск по смыслу в своих Telegram-переписках за вечер. Telethon, sqlite-vec, OpenAI embeddings — и больше никаких ctrl+F по 50 чатам."
tags:
  - вайбкодинг
  - Telegram
  - RAG
  - sqlite-vec
section: "Проекты"
---

Вася три месяца назад скинул решение бага с async — помню точно. В каком из 47 чатов — уже нет.

Пробовал Ctrl+F: "async", "await", "баг". Telegram выдал 200+ совпадений. Половина — про что угодно, только не то. Стандартный поиск ищет слова. Мне нужен смысл.

## Идея

Что если искать не по словам, а по смыслу? "Деплой", "выкатить на прод", "залить на сервер" — для меня одно и то же. Для Ctrl+F — три разных запроса.

Написал агенту:

{{< callout prompt >}}
Сделай поиск по моим чатам в Telegram. Хочу писать "то решение с concurrent requests" — и находить нужное сообщение, даже если там слов "concurrent" нет.
{{< /callout >}}

Агент объяснил: нужны эмбеддинги. Текст превращается в вектор — набор чисел. Похожие по смыслу тексты оказываются рядом в этом пространстве. Математика, не магия.

## Первая попытка

За час агент собрал рабочую версию. Скачивание сообщений, генерация эмбеддингов, поиск по похожести.

Запустил синхронизацию на ночь. 50 чатов, 60 дней истории.

В 2 ночи проснулся от уведомления. Telegram выдал FloodWait на 2 часа — API заблокировано за слишком частые запросы. Скрипт качал без пауз.

## Исправление

{{< callout prompt >}}
Telegram забанил за спам. Добавь random задержки между запросами — не фиксированные, а случайные. И обработку FloodWaitError: если словили — ждём сколько сказали плюс запас.
{{< /callout >}}

Агент добавил:
- 1-3 секунды между чатами (random)
- 0.1-0.3 секунды между батчами сообщений
- При FloodWaitError — sleep на `e.seconds + 10` и пропуск чата

Перезапустил. За ночь синхронизировал всё — ни одного бана.

## Ещё одна ошибка

Поиск работал странно. Выдавал не самые похожие результаты.

Оказалось, агент использовал обычный SQL:

```sql
SELECT * FROM vec_messages ORDER BY distance LIMIT 10
```

А sqlite-vec требует другой синтаксис:

```sql
WHERE embedding MATCH ? AND k = 10
```

{{< callout warning "sqlite-vec gotcha" >}}
Для KNN-запросов в sqlite-vec нельзя использовать LIMIT — только параметр `k = ?`. Стандартный SQL паттерн не работает.
{{< /callout >}}

Указал явно в промпте. Исправил за минуту.

## Результат

Теперь пишу в терминале:

```bash
python search.py "решение с rate limiting"
```

Нахожу именно то сообщение от Васи. Секунда вместо 15 минут скроллинга.

Другие запросы, которые работают:
- "что обсуждали про деплой"
- "рекомендация книги от Пети"
- "тот скрипт для парсинга"

15 тысяч сообщений, эмбеддинги сгенерировались за 10 минут. $0.02 — text-embedding-3-small дешёвый.

## Что понял про процесс

**Первая версия будет сломана.** Telegram API, sqlite-vec синтаксис — агент не знает всех особенностей. Но он быстро чинит, когда объясняешь что не так.

**Конкретные ошибки → конкретные фиксы.** "Telegram забанил за спам" полезнее чем "добавь rate limiting". Агент понимает контекст.

**Простой стек побеждает.** sqlite-vec — один файл, нет сервера. Бэкап = копирование файла. Pinecone красивый, но зачем для 15k сообщений?

## Если хочешь попробовать

Начни с малого. Один чат, 100 сообщений. Убедись что поиск работает. Потом масштабируй.

Попробуй адаптировать под свой источник:
- **Slack** — каналы = чаты, сообщения = сообщения
- **Discord** — discord.py вместо Telethon
- **Email** — IMAP для скачивания
- **Заметки** — Obsidian export в markdown

Скрипт не важен. Важна модель: скачал → эмбеддинги → поиск. Каждый шаг отлаживается отдельно.

---

## Источники

- [telegram-search](https://github.com/groupultra/telegram-search) — похожий проект с 3.7k звёзд
- [sqlite-vec](https://github.com/asg017/sqlite-vec) — векторное расширение для SQLite
- [How sqlite-vec Works](https://medium.com/@stephenc211/how-sqlite-vec-works-for-storing-and-querying-vector-embeddings-165adeeeceea) — подробный разбор
- [Telegram 429 handling](https://pcg-telegram.com/blogs/893) — rate limiting в 2025-2026
