---
title: "Модульные правила: как не утонуть в CLAUDE.md"
date: 2026-01-17
description: "Один CLAUDE.md на 500 строк — боль. Разбиваю на .claude/rules/ по доменам: база данных, тесты, фронтенд. Практический гайд с примерами."
tags: ["claude code", "документация"]
section: Claude Code
knowledge:
  problem: "CLAUDE.md раздувается до сотен строк, данные противоречат друг другу в разных местах."
  solution: "Разбиение правил на модульные файлы в .claude/rules/ по доменам с фильтрацией по путям."
  pattern: "modular-agent-rules"
  tools: ["Claude Code", ".claude/rules/"]
  takeaways:
    - "CLAUDE.md на 400 строк приводит к выборочному запоминанию и противоречиям"
    - "Файлы в .claude/rules/ фильтруются по paths: — правила подгружаются только для релевантных файлов"
    - "Изменяемые данные не дублировать в документации — описывать как достать из базы"
    - "Корневой CLAUDE.md оставить для навигации, команд и ссылок на rules"
    - "Секция Before Querying с .schema устранила ошибки агента с именами колонок"
  related:
    - slug: "fix-once-rule-forever"
      relation: "принцип фиксации ошибок в правилах"
    - slug: "ssot-documentation"
      relation: "single source of truth для документации"
---

CLAUDE.md раздулся до 400 строк. Агент читает, но запоминает выборочно.

Спросил количество студентов — выдал 19. В базе 24.

Документация врала в трёх местах по-разному.

## Как это случилось

Начинаешь проект — пишешь CLAUDE.md. Команды запуска, структура папок, правила коммитов. Через неделю добавляешь схему базы. Ещё через неделю — тесты и особенности фронтенда.

К концу месяца файл на 400 строк. Агент его читает. Но когда данные противоречат друг другу — выбирает случайно.

Количество студентов оказалось записано в трёх местах:
- CLAUDE.md — 19 человек
- .claude/rules/students.md — 19 человек
- База данных — 24 человека

Я забыл обновить документацию после добавления пяти новых студентов. База была правильной, но агент читал markdown.

## Решение: .claude/rules/

Claude Code умеет подгружать правила из папки `.claude/rules/`. Каждый файл — отдельный домен. База данных, тесты, фронтенд, студенты.

```
.claude/
├── rules/
│   ├── database.md      # схема, миграции, частые ошибки
│   ├── testing.md       # как запускать тесты, фикстуры
│   ├── students.md      # API телеграма, синхронизация
│   ├── atoms.md         # концепция атомов знаний
│   └── frontend/
│       └── ui-patterns.md
└── skills/
    └── ...
```

В корневом CLAUDE.md остаётся только навигация. Что где искать. Основные команды. Ссылки на rules.

{{< callout insight >}}
Если данные живут в базе — не дублируй их в документации. Напиши как их достать.
{{< /callout >}}

## Пример: database.md

Агент трижды пытался сделать `SELECT lesson_date FROM lessons`. Такой колонки нет — она называется `date`. Потом пробовал `SELECT title` и `SELECT topic`. Тоже мимо — это `summary`.

Добавил секцию «Before Querying» с командой проверки схемы:

```markdown
## Before Querying

**Проверяй схему перед SELECT:**

\`\`\`bash
sqlite3 backend/cohorts.db ".schema lessons"
\`\`\`

**Частые ошибки:**
- lesson_date → date
- title, topic → summary
- name → first_name, last_name
```

Сначала `.schema`, потом запрос. После этого ошибки прекратились.

## Что куда класть

| Файл | Содержимое |
|------|------------|
| CLAUDE.md | Навигация, команды запуска, критичные правила |
| database.md | Схема таблиц, миграции, частые ошибки SQL |
| testing.md | Как запускать тесты, фикстуры, покрытие |
| frontend/*.md | UI-паттерны, компоненты, линтеры |

## Фильтрация по путям

В начале файла можно указать, когда его подгружать:

```markdown
---
paths: backend/**/*.py, migrations/**
---

# Database Rules
...
```

Теперь правила базы подгружаются только когда агент работает с бэкендом. Фронтендеру они не нужны.

## Когда обновлять

Документация устаревает. Три правила помогают:

- Добавил фичу — проверь rules
- Нашёл рассинхрон — исправь сразу
- Данные в базе — не дублируй, опиши как достать

Агент находит рассинхроны: читает документацию, проверяет базу, видит противоречие. Спрашивает или ошибается — оба пути ведут к исправлению.

{{< callout warning "Не дублируй изменяемые данные" >}}
«24 студента» в документации устареет завтра. Лучше: «количество студентов — в таблице students».
{{< /callout >}}

## Структура

CLAUDE.md — точка входа: навигация, команды запуска, ссылки на rules.

Правила по доменам — в `.claude/rules/`. Маленький файл проще обновить и проще найти где ошибка.

База данных — источник правды для изменяемых данных. Агент будет ошибаться. Но не из-за устаревшей документации.

## Источники

- [The Complete Guide to CLAUDE.md — Builder.io](https://www.builder.io/blog/claude-md-guide)
- [Creating the Perfect CLAUDE.md — Dometrain](https://dometrain.com/blog/creating-the-perfect-claudemd-for-claude-code/)
- [Claude Code Project Configuration Showcase — GitHub](https://github.com/ChrisWiles/claude-code-showcase)
- [Using AI coding assistants — Modular Docs](https://docs.modular.com/max/coding-assistants/)
