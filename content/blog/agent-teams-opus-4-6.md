---
title: "Agent Teams в Claude Code: команда агентов за 5 минут"
date: 2026-02-05
description: "Opus 4.6 принёс Agent Teams — несколько агентов работают параллельно над одной задачей. Как включить, когда использовать и как я собрал чат на стриме за 15 минут двумя агентами."
tags: ["claude-code", "ai-agents", "вайбкодинг", "opus"]
image: "/images/blog/agent-teams-opus-4-6-preview.png"
---

{{< youtube vVpmc-C1yrM >}}

Сегодня Anthropic выпустил [Claude Opus 4.6](https://www.anthropic.com/news/claude-opus-4-6). Главная фича — Agent Teams. Один агент делал всё сам, теперь можно собрать команду из нескольких, которые работают параллельно и общаются между собой. Даёшь один промпт — три агента расходятся проверять разные гипотезы одновременно.

Звучит как субагенты? Нет. Разница принципиальная.

## Не путай с subagents

Subagents — помощники. Получили задачу от лидера, сделали, отчитались обратно. Вся коммуникация идёт через главного агента. Как курьеры: принёс — отдал — свободен.

Agent Teams — другое. Это полноценная команда с горизонтальной коммуникацией. У каждого teammate свой контекст, но они общаются друг с другом напрямую. Есть shared task list, куда все заглядывают. Есть mailbox для сообщений между агентами — без посредников.

```
┌─────────────────────────────────────────┐
│              Team Lead (ты)             │
│  координирует, назначает, синтезирует   │
└──────┬──────────┬──────────┬────────────┘
       │          │          │
       ▼          ▼          ▼
┌──────────┐ ┌──────────┐ ┌──────────┐
│Teammate 1│ │Teammate 2│ │Teammate 3│
│ Security │ │  Perf    │ │  Tests   │
└──────────┘ └──────────┘ └──────────┘
       │          │          │
       └──────────┼──────────┘
                  ▼
         Shared Task List
```

Ты — лид. Ставишь задачи, читаешь что пишут друг другу teammates, собираешь итог. Они работают параллельно, спорят между собой, и синхронизируются через общий task list.

## Включить — одна строчка

Agent Teams пока в experimental. По умолчанию выключены.

Открываешь `settings.json` Claude Code и добавляешь:

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

Готово. Дальше просишь Claude создать команду — он поймёт.

## Когда Teams, когда subagents

| | Subagents | Agent Teams |
|---|-----------|-------------|
| Коммуникация | Только с лидером | Напрямую друг с другом |
| Контекст | Общий с лидером | Каждый — независимый |
| Координация | Лидер раздаёт | Shared task list |
| Подходит для | Фокусированная задача | Параллельная работа |
| Расход токенов | Умеренный | Заметно больше |

Простое правило: задачи можно делить и делать параллельно — Teams. Нужна одна цепочка рассуждений — subagents. Про расход токенов и экономику AI-инструментов [писал отдельно](/blog/ai-coding-tools-economics-2026).

## Четыре сценария, где Teams работают

[Документация Anthropic](https://code.claude.com/docs/en/agent-teams) выделяет четыре кейса:

| Сценарий | Почему хорошо | Не подходит |
|----------|---------------|-------------|
| **Ревью кода** | Security, performance, тесты — параллельно | Тривиальный PR |
| **Новые модули** | Каждый agent владеет своим куском | Рефакторинг одного файла |
| **Debugging** | Гипотезы тестируются одновременно | Очевидный баг |
| **Cross-layer фичи** | Frontend + backend + тесты | Только UI-правка |

Главное условие — изоляция. Два агента в одном файле = конфликты и потерянное время. Задачи должны быть чётко разделены по файлам.

Параллельных агентов для разных задач я уже использовал — в [пайплайне для статей](/blog/blog-post-pipeline) один пишет драфт, другой ищет ссылки, третий готовит иллюстрации. Но там субагенты. Teams дают ещё один слой — агенты могут обсуждать находки между собой.

## Запуск первой команды

Просишь Claude создать команду. Никаких команд в терминале — естественный язык.

{{< callout type="insight" >}}
Создай команду из трёх агентов для ревью этого PR. Один проверяет security, второй — performance, третий — покрытие тестами. Пусть обсудят находки между собой и дадут общий итог.
{{< /callout >}}

Claude сам создаёт task list, спавнит teammates, распределяет задачи. Ты наблюдаешь и корректируешь.

Ещё примеры:

- «Баг в продакшене — медленная загрузка. Одного агента пусти на базу данных, второго на сетевые запросы, третьего на утечки памяти.»
- «Нужна авторизация через OAuth. Один пишет backend, другой — фронт, третий — интеграционные тесты.»
- «Мигрируем с REST на GraphQL. Разбей по слоям: API, клиент, обратная совместимость.»

Заметь — нигде не нужно указывать технические параметры. Claude сам разберётся сколько teammate'ов нужно.

## Два режима отображения

**In-process** (по умолчанию) — все агенты в одном терминале. Переключаешься через Shift+Up/Down. Видишь переписку, читаешь кто чем занят. Для команды из 3-4 агентов — хватает.

**Split panes** (tmux или iTerm2) — каждый агент в отдельной панели. Видишь всех одновременно. Красиво, но требует настройки мультиплексора и экран побольше.

Для начала хватит in-process. Split panes — когда распробуешь и захочется больше контроля.

## Пять советов из документации

Anthropic в [руководстве по Agent Teams](https://code.claude.com/docs/en/agent-teams) делится практиками:

**1. Контекст для teammates.** Они не знают что ты обсуждал до этого. Conversation history лидера к ним не попадает. Если нужен контекст — передай явно при создании команды.

**2. Правильный размер задач.** 5-6 задач на teammate — золотая середина. Слишком мелко — overhead на координацию съедает выигрыш. Слишком крупно — агент теряет фокус.

**3. Один файл — один agent.** Два teammate'а в одном файле = перезаписи и конфликты. Раздели работу так, чтобы каждый владел своим набором файлов.

**4. Проверяй и направляй.** Не уходи на два часа. Читай task list, смотри сообщения между агентами, корректируй если кто-то пошёл не туда.

**5. Начни с research, не с кода.** Первая команда пусть проверит что-то существующее — сделает ревью, исследует библиотеку, найдёт причину бага. Почувствуешь механику без риска сломать проект.

Про [хранение контекста между сессиями агентов](/blog/github-projects-ai-agent-memory) — отдельная тема, но с Teams это ещё актуальнее.

## Ограничения

Agent Teams — experimental preview. Будь готов к шероховатостям:

| Ограничение | Что это значит |
|-------------|---------------|
| Experimental | API может измениться |
| Нет resume | Если teammate упал — создавай заново |
| Один тим | Нельзя вести две команды одновременно |
| Больше токенов | Каждый agent — отдельный контекст |
| Split panes | Только tmux / iTerm2 |

Для линейных задач Teams — overkill. Координационный overhead не окупится. Обычный агент или субагент справится быстрее и дешевле.

## Что Anthropic делает сам

В [инженерном блоге Anthropic](https://www.anthropic.com/engineering/building-c-compiler) описывают эксперимент: 16 параллельных Claude-инстансов написали C compiler на Rust. Сто тысяч строк кода. Компилирует Linux kernel. Примерно $20k в API.

Другой пример из [анонса Opus 4.6](https://www.anthropic.com/news/claude-opus-4-6) — Rakuten. За один день Opus 4.6 закрыл 13 issues и назначил 12 issues нужным людям в команде.

Масштаб, конечно, enterprise. Но механика та же — разделил задачи, раздал агентам, собрал результат.

## Мой опыт: чат в реальном времени на стриме

Теорию рассказал — теперь практика. На [YouTube-стриме](https://youtube.com/live/vVpmc-C1yrM) я попробовал Agent Teams для конкретной задачи: собрать real-time чат, где зрители пишут без регистрации — только имя.

### Команда

Создал команду `chat-mvp` из двух teammates:

| Agent | Задача | Файлы |
|-------|--------|-------|
| **backend-dev** | Express + Socket.IO сервер | `server/index.js` |
| **frontend-dev** | React + Vite клиент | `client/src/` |
| **Lead** (я + Claude) | Координация, ревью, деплой | `Dockerfile`, конфиги |

Три задачи в shared task list — сервер, клиент, Docker для деплоя. Каждый agent владел своим набором файлов, конфликтов не было.

### Что произошло

Research через Exa MCP выбрал стек за минуту — Socket.IO для вебсокетов, Vite для клиента. Оба агента стартовали параллельно. Backend-dev поднял Express-сервер с обработкой событий: `join`, `message`, `typing`, `disconnect`. Frontend-dev собрал React-приложение — форма входа, чат-комната, список онлайн-пользователей.

Примерно через две минуты оба отчитались. При ревью нашёл баг — сервер эмитил `user-joined` и `users-list`, а клиент слушал `message` и `users`. Классический mismatch при параллельной разработке. Починили, привели к единому протоколу.

Задеплоил на Railway через Dockerfile (multi-stage build: Vite собирает клиент → Node.js раздаёт статику). 15+ зрителей зашли сразу.

### Что добавил после

Чат без модерации — хаос. Дописал прямо на стриме:

- **Rate limit** — максимум 5 сообщений за 10 секунд
- **Slow mode** — пауза 2 секунды между сообщениями
- **Дубликаты** — одинаковые сообщения подряд блокируются
- **MOD badge** — первый зашедший получает значок модератора
- **Лимит подключений** — не больше 3 с одного IP

### Что сработало

**Параллельность окупилась.** Backend и frontend — идеальное разделение для Teams. Файлы не пересекаются, контракт — Socket.IO события.

**Shared task list работает.** Оба агента видели прогресс друг друга, lead следил за общей картиной.

**Скорость.** От промпта до работающего чата с деплоем — около 15 минут на стриме. Без Teams было бы последовательно и дольше.

### Что не сработало

**Event mismatch** — главная проблема параллельной разработки. Два агента независимо выбрали разные имена для одних и тех же событий. Контракт нужно фиксировать до старта работы, а не надеяться что агенты договорятся.

**node_modules в git** — один из агентов закоммитил зависимости. Мелочь, но напоминание: `.gitignore` должен быть готов до спавна команды.

Код на GitHub: [serejaris/yt-chat-stream](https://github.com/serejaris/yt-chat-stream). Стрим целиком: [YouTube](https://youtube.com/live/vVpmc-C1yrM).

## Почему именно сейчас

Agent Teams появились вместе с Opus 4.6, который [вышел сегодня](https://techcrunch.com/2026/02/05/anthropic-releases-opus-4-6-with-new-agent-teams/). Что в нём нового помимо Teams:

- **1M token context window** — вдвое больше предыдущего Opus
- Улучшения в planning и code review
- Конкурирует с Gemini 3 Pro и GPT-5.2 в coding-бенчмарках — где-то впереди, где-то нет, но в целом на одном уровне

По [данным Anthropic](https://resources.anthropic.com/hubfs/2026%20Agentic%20Coding%20Trends%20Report.pdf), разработка сдвигается от написания кода к оркестрации агентов. Организации отчитываются о 30-79% ускорении циклов разработки с AI-агентами. Teams — следующий логичный шаг.

## Итог

Один промпт — и у тебя команда агентов. Включается за минуту. Работает в Claude Code на Opus 4.6 из коробки.

Начни с простого: «создай команду для ревью — security, performance, tests». Посмотри как агенты переписываются, как обновляется task list, как собирается итог. Если понравится — пробуй debugging с конкурирующими гипотезами или параллельную разработку по слоям.

[Документация Agent Teams](https://code.claude.com/docs/en/agent-teams) — там детали про split panes и продвинутые сценарии.
