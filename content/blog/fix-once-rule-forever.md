---
title: "Правка → Правило: как научить агента не повторять ошибки"
date: 2026-02-01
description: "Паттерн для работы с AI-агентами: исправил ошибку — записал правило — больше не повторится. Fix once, remember forever."
tags: ["claude-code", "вайбкодинг", "agents", "cursor"]
---

Сегодня агент забыл обновить index.html после создания lesson-page. Третий раз за неделю. Я исправил, потом записал правило в CLAUDE.md. Больше не забудет.

Раньше я бы просто добавил строчку и пошёл дальше. Через три дня — снова.

## Агенты не помнят

Claude Code не знает что делал вчера. Cursor не помнит какие грабли ты собирал в прошлом проекте. Каждая сессия — чистый лист.

Контекст у Claude — 200 тысяч токенов. Звучит много. На практике 45 тысяч зарезервировано под буфер, ещё часть съедает код проекта. К середине сессии память заканчивается.

Сказал "не делай так"? Через час забыл. Написал коммент в коде? Может пропустить.

Нужен способ превращать правки в правила.

## Файлы правил

Все современные агенты читают правила из файлов:

- Claude Code — `CLAUDE.md` и `.claude/rules/`
- Cursor — `.cursorrules` или `.cursor/rules/`
- Windsurf — `.windsurfrules`
- Универсальный формат — `AGENTS.md`

```
ОШИБКА                    ПРАВИЛО                   РЕЗУЛЬТАТ
   │                          │                          │
   │ Забыл обновить      →    │ "При создании lesson-  → │ Не забывает
   │ index.html               │  page обновить index"    │
```

Паттерн простой. Агент накосячил — запиши правило — больше не повторится.

## Compound effect

Одно правило — мелочь. Два — тоже. Через месяц у тебя 15 правил. Через полгода — 50.

В моём проекте cohorts сейчас 8 файлов в `.claude/rules/`: database.md, atoms.md, students.md, testing.md, checklist.md, lesson-planning.md и пара для фронтенда. Каждый появился после конкретной ошибки.

```
Месяц 1:                    Месяц 6:
────────────                ─────────────────────
│ CLAUDE.md │               │ CLAUDE.md         │
│ - команды │               │ - команды         │
└───────────┘               │                   │
                            │ .claude/rules/    │
                            │ ├── database.md   │
                            │ ├── atoms.md      │
                            │ ├── students.md   │
                            │ ├── testing.md    │
                            │ └── ...ещё 4      │
                            └───────────────────┘
```

Агент с правилами работает по-другому. Меньше переделок. Меньше "я же говорил". Со временем разница становится заметной.

## Claude Code: модульные правила

В корне проекта — `CLAUDE.md`. Команды запуска, структура, критичные ограничения.

Детали выносятся в `.claude/rules/`:

```
.claude/
├── rules/
│   ├── database.md      # схема, частые ошибки SQL
│   ├── testing.md       # как запускать тесты
│   ├── frontend/
│   │   └── exports.md   # правила для index.ts
│   └── commits.md       # conventional commits
└── skills/
```

Можно указать когда правило применять:

```markdown
---
paths: frontend/**/*.tsx
---

# Frontend Rules
...
```

Теперь это правило загружается только при работе с фронтендом. Бэкенд его не видит.

## Cursor: от .cursorrules к .cursor/rules/

Cursor долго поддерживал один файл — `.cursorrules`. Все правила в одном месте.

Проблема: файл раздувается. 500 строк, 800 строк. Агент читает всё, применяет выборочно.

С конца 2025 Cursor поддерживает `.cursor/rules/` — модульную структуру. Переход простой: разбиваешь старый файл по доменам, добавляешь `paths:` для фильтрации.

## AGENTS.md: один файл для всех

Появился универсальный формат — `AGENTS.md`. Его уже используют 60 тысяч репозиториев на GitHub.

Идея: один файл работает в Claude Code, Cursor, Copilot, Codex, Devin. Пишешь раз — работает везде.

Структура похожа на CLAUDE.md: команды, архитектура, правила стиля, частые ошибки.

По-моему, это правильное направление. Правила должны быть переносимыми между инструментами.

## Спроси агента

В конце сессии полезно спросить:

> "Какие проблемы заметил? Что добавить в правила?"

На прошлой неделе Claude Code сам предложил: "Три раза уточнял формат дат — стоит добавить в database.md". Добавил. Работает.

Агент видит паттерны которые ты можешь пропустить. Это бесплатная обратная связь.

## Когда не добавлять

Не всё должно быть правилом:

- **Разовые кейсы** — не повторятся
- **Очевидное** — "пиши читаемый код"
- **Слишком специфичное** — "в файле X на строке 42"

Правила для паттернов. Видишь проблему второй раз — записывай.

## Итог

Fix once, remember forever.

Каждая правка — возможность улучшить систему. Записывай ошибки в правила. Со временем агент подстраивается под твой проект.

Через месяц заметишь. Через полгода будет казаться что агент читает мысли.

Он не читает. Он читает твои правила.

## Источники

- [The Complete Guide to CLAUDE.md — Builder.io](https://www.builder.io/blog/claude-md-guide)
- [AGENTS.md — официальный сайт](https://agents.md/)
- [How to write a great agents.md — GitHub Blog](https://github.blog/ai-and-ml/github-copilot/how-to-write-a-great-agents-md-lessons-from-over-2500-repositories/)
- [Claude Code Context Buffer — claudefa.st](https://claudefa.st/blog/guide/mechanics/context-buffer-management)
- [Cursor Rules Directory](https://cursor.directory/)
